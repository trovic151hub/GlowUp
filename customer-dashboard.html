<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
<style>
/* ===== MODAL & TIMELINE STYLES ===== */
.modal-bg { background: rgba(0,0,0,0.5); }
.timeline-step { transition: all 0.3s ease; }
.timeline-line { transition: background-color 0.3s ease; }

.timeline-step {
    transition: background-color 0.5s ease;
  }
  .timeline-line {
    transition: background-color 0.5s ease;
    height: 4px;
    border-radius: 2px;
  }
/* ===== MOBILE DASHBOARD FIXES ===== */
@media (max-width: 640px) {
  main { padding: 1rem !important; }
  h2 { font-size: 1rem !important; text-align: center; }
  .dashboard-card { padding: 1rem !important; }
  .status-filter-wrapper { overflow-x: auto; display: flex; gap: 0.5rem; padding-bottom: 5px; }
  .status-btn { white-space: nowrap; font-size: 0.75rem; padding: 6px 10px !important; }
  .table-wrapper { overflow-x: auto; }
  table { min-width: 300px; }
  #orderModal > div { width: 95% !important; max-height: 80vh !important; }
}

/* Custom Media Queries for Footer */
@media (max-width: 768px) {
  footer {
    text-align: left;
  }

  footer .mx-6 {
    margin-left: 1rem;
    margin-right: 1rem;
  }

  footer input {
    width: 100% !important;
    margin-bottom: 0.5rem;
  }

  footer button {
    /* width: 100%; */
  }

  footer .flex-col {
    flex-direction: column !important;
    gap: 1.5rem !important;
  }

  footer .text-left {
    text-align: center !important;
  }
}

  .powered-btn {
    display: block;
    text-align: left;
  }

@media (max-width: 480px) {
  footer h4 {
    font-size: 1rem;
  }

  footer p {
    font-size: 0.875rem;
  }

  footer .fixed.bottom-6.right-6 {
    width: 3rem;
    height: 3rem;
    font-size: 1.5rem;
  }
}

@keyframes ripple {
  0% {
    transform: scale(0.8);
    opacity: 0.6;
  }
  100% {
    transform: scale(2.5);
    opacity: 0;
  }
}

.ripple-effect {
  animation: ripple 1.5s infinite;
}
</style>
</head>
<body class="bg-gray-50 text-gray-900">

<!-- Loader -->
<div id="dashboard-loader" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50 hidden">
  <svg xmlns="http://www.w3.org/2000/svg" class="fas fa-shopping-cart text-white w-12 h-12 animate-pulse" viewBox="0 0 16 16">
    <path fill="currentColor" d="M0 2.5A.5.5 0 0 1 .5 2H2a.5.5 0 0 1 .485.379L2.89 4H14.5a.5.5 0 0 1 .485.621l-1.5 6A.5.5 0 0 1 13 11H4a.5.5 0 0 1-.485-.379L1.61 3H.5a.5.5 0 0 1-.5-.5M3.14 5l.5 2H5V5zM6 5v2h2V5zm3 0v2h2V5zm3 0v2h1.36l.5-2zm1.11 3H12v2h.61zM11 8H9v2h2zM8 8H6v2h2zM5 8H3.89l.5 2H5zm0 5a1 1 0 1 0 0 2a1 1 0 0 0 0-2m-2 1a2 2 0 1 1 4 0a2 2 0 0 1-4 0m9-1a1 1 0 1 0 0 2a1 1 0 0 0 0-2m-2 1a2 2 0 1 1 4 0a2 2 0 0 1-4 0"/>
  </svg>
</div>

<header class="bg-gradient-to-r from-pink-300 to-pink-400 p-4 shadow-md flex justify-between items-center z-50 fixed top-0 w-full">
  <button onclick="history.back()">
    <h1 class="text-xl font-bold">ðŸ‘¤ My Dashboard</h1>
  </button>
</header>

<main class="max-w-5xl mx-auto p-6 mt-20">
  <h2 class="text-lg font-semibold mb-4">Welcome, <span id="userName">Customer</span> ðŸ‘‹</h2>

  <div class="bg-white p-6 rounded shadow">
    <h3 class="text-md font-semibold mb-4">ðŸ“¦ Your Orders</h3>
    <div class="fil mb-4 block gap-2 items-center">
      <span class="font-semibold">Filter by Status:</span>
      <div class="flex gap-2 overflow-x-auto">
        <button onclick="filterOrders('All')" class="status-btn bg-pink-100 px-3 py-1 rounded hover:bg-pink-200" data-status="All">All</button>
        <button onclick="filterOrders('Pending')" class="status-btn bg-pink-100 px-3 py-1 rounded hover:bg-pink-200" data-status="Pending">Pending</button>
        <button onclick="filterOrders('Shipped')" class="status-btn bg-pink-100 px-3 py-1 rounded hover:bg-pink-200" data-status="Shipped">Shipped</button>
        <button onclick="filterOrders('Delivered')" class="status-btn bg-pink-100 px-3 py-1 rounded hover:bg-pink-200" data-status="Delivered">Delivered</button>
      </div>
    </div>
    <div class="table-wrapper overflow-x-auto">
      <table class="w-full border text-sm">
        <thead class="bg-pink-100">
          <tr>
            <th class="p-2">Date</th>
            <th class="p-2">Total</th>
            <th class="p-2">Items</th>
            <th class="p-2">Status</th>
            <th class="p-2">Action</th>
          </tr>
        </thead>
        <tbody id="orderTableBody"></tbody>
      </table>
    </div>
    <div id="paginationControls" class="flex items-center gap-2 mt-3 justify-center"></div>
  </div>
</main>

<!-- Modal -->
<div id="orderModal" class="hidden fixed inset-0 flex items-center justify-center z-40 modal-bg">
  <div class="bg-white w-11/12 max-w-lg p-6 rounded shadow-lg max-h-[80vh] overflow-y-auto">
    <h2 class="text-xl font-bold mb-4">Order Details</h2>
    <div id="modalContent" class="space-y-4"></div>
    <div class="flex justify-end gap-2 mt-4">
      <button onclick="closeModal()" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">Close</button>
      <button id="saveBtn" class="bg-pink-500 px-4 py-2 rounded hover:bg-pink-600 text-white hidden">Save Changes</button>
    </div>
  </div>
</div>

<!-- Footer -->
<footer class="bg-pink-100 text-gray-800 relative">
  <div class="mx-6 md:mx-10 px-4 md:px-6 py-8 md:py-12 flex flex-col md:flex-row justify-between gap-8 md:gap-40">
    
    <!-- Contact Info -->
    <div class="flex-1 border-b md:border-b-0 pb-4 md:pb-0 border-gray-300">
      <h4 class="text-lg font-semibold mb-4">CONTACT US</h4>
      <p class="mb-2 flex items-center gap-2">
        <i class="fas fa-phone-alt"></i> +2349053380773
      </p>
      <p class="flex items-start gap-2">
        <i class="fas fa-map-marker-alt mt-1"></i>
        Lagos, Nigeria
      </p>
    </div>

    <!-- Newsletter -->
    <div class="flex-1">
      <h4 class="text-lg font-semibold mb-3">SIGN UP FOR DISCOUNTS & UPDATES</h4>
      <div class="block flex-col md:flex-row gap-2 md:gap-4 items-start md:items-center">
        <input type="text" placeholder="Enter your phone number or email address" 
               class="w-full md:w-[100%] px-4 py-2 rounded border border-gray-300 focus:outline-none">
        <button class="mt-3 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
          Subscribe
        </button>
      </div>
    </div>
  </div>

  <!-- Powered By -->
  <div class="btn text-left text-sm text-white mx-6 md:mx-10 px-4 md:px-6 py-4 border-t border-gray-300">
    <button class="text-left block p-4 bg-pink-500">
      POWERED BY VTec
    </button>
  </div>

  <!-- WhatsApp Button -->
<button id="openWhatsappModal" class="fixed bottom-6 right-6 z-50">
  <div class="relative w-14 h-14">
    <!-- Ripple circles -->
    <span class="absolute inset-0 rounded-full bg-green-400 opacity-50 animate-ping"></span>
    <span class="absolute inset-0 rounded-full bg-green-400 opacity-50 animate-ping delay-200"></span>
    <span class="absolute inset-0 rounded-full bg-green-400 opacity-50 animate-ping delay-400"></span>

    <!-- Main Button -->
    <div class="relative w-14 h-14 rounded-full bg-green-500 hover:bg-green-600 text-white flex items-center justify-center shadow-lg text-2xl">
      <i class="fab fa-whatsapp"></i>
    </div>
  </div>
</button>

  <!-- WhatsApp Button -->
<a href="https://wa.me/2349053380773" target="_blank" class="fixed bottom-6 right-6 z-50">
  <div class="relative w-14 h-14">
    <!-- Ripple circles -->
    <span class="absolute inset-0 rounded-full bg-green-400 opacity-50 animate-ping"></span>
    <span class="absolute inset-0 rounded-full bg-green-400 opacity-50 animate-ping delay-200"></span>
    <span class="absolute inset-0 rounded-full bg-green-400 opacity-50 animate-ping delay-400"></span>

    <!-- Main Button -->
    <div class="relative w-14 h-14 rounded-full bg-green-500 hover:bg-green-600 text-white flex items-center justify-center shadow-lg text-2xl">
      <i class="fab fa-whatsapp"></i>
    </div>
  </div>
</a>
</footer>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // ===== Loader =====
  let loader = document.getElementById("dashboard-loader");
  if (!loader) {
    loader = document.createElement("div");
    loader.id = "dashboard-loader";
    loader.className = "fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50 hidden";
    loader.innerHTML = `<i class="fas fa-spinner fa-pulse text-6xl text-white"></i>`;
    document.body.appendChild(loader);
  }

  function showLoader() {
    loader.classList.remove("hidden");
    document.body.style.overflow = "hidden";
    document.body.style.pointerEvents = "none";
  }

  function hideLoader() {
    loader.classList.add("hidden");
    document.body.style.overflow = "";
    document.body.style.pointerEvents = "";
  }

  // ===== Firebase =====
  const firebaseConfig = {
    apiKey: "AIzaSyDdTPmpaIPWSDWOmR-fXgvAb7hoxZUawcc",
    authDomain: "e-commerce-39c74.firebaseapp.com",
    projectId: "e-commerce-39c74",
    storageBucket: "e-commerce-39c74.firebasestorage.app",
    messagingSenderId: "863375033754",
    appId: "1:863375033754:web:7ba248c8dbb1566c83e623"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // ===== Guest ID =====
  function getGuestId() {
    let id = localStorage.getItem("guestId");
    if (!id) {
      id = "guest_" + crypto.randomUUID();
      localStorage.setItem("guestId", id);
    }
    return id;
  }
  const guestId = getGuestId();
  console.log("Dashboard guestId:", guestId);
  console.log("Dashboard guestId (should match DevTools):", guestId);

  // ===== DOM Elements =====
  const userNameSpan = document.getElementById("userName");
  const orderTableBody = document.getElementById("orderTableBody");
  const orderModal = document.getElementById("orderModal");
  const modalContent = document.getElementById("modalContent");
  const saveBtn = document.getElementById("saveBtn");
  const pageSize = 10;
  const NON_EDITABLE_STATUSES = ["processing", "shipped", "delivered"];

  let currentUser = null;
  let allOrders = [];
  let currentFilter = "All";
  let currentPage = 1;
  let ordersUnsub = null;
  let openedOrderId = null;
  let openedOrderMode = "view";


  // ===== Notifications =====
  const activeNotifications = new Set();
  function showNotification(message, type="info", duration=3000) {
    let container = document.getElementById("notification-container");
    if(!container){
      container = document.createElement("div");
      container.id = "notification-container";
      container.className = "fixed top-4 right-4 z-50 flex flex-col gap-2";
      document.body.appendChild(container);
    }
    if(activeNotifications.has(message)) return;
    activeNotifications.add(message);

    const notif = document.createElement("div");
    notif.className = `flex items-center justify-between gap-3 p-4 bg-white rounded-lg shadow-lg border border-gray-200 min-w-[250px] max-w-sm animate-slideIn`;
    const icon = document.createElement("span");
    if(type==="success") icon.innerHTML=`<i class="fas fa-check-circle text-green-500 text-xl"></i>`;
    else if(type==="error") icon.innerHTML=`<i class="fas fa-times-circle text-red-500 text-xl"></i>`;
    else if(type==="warning") icon.innerHTML=`<i class="fas fa-exclamation-triangle text-yellow-500 text-xl"></i>`;
    else icon.innerHTML=`<i class="fas fa-info-circle text-blue-500 text-xl"></i>`;
    const text = document.createElement("span");
    text.className="flex-1 text-gray-800 font-medium";
    text.textContent = message;
    const closeBtn = document.createElement("button");
    closeBtn.innerHTML = "&times;";
    closeBtn.className = "ml-4 text-gray-400 hover:text-gray-600 font-bold text-lg";
    closeBtn.onclick = () => removeNotification(notif, message);
    notif.appendChild(icon);
    notif.appendChild(text);
    notif.appendChild(closeBtn);
    container.appendChild(notif);
    setTimeout(()=> removeNotification(notif, message), duration);
  }

  function removeNotification(notif, message){
    if(!notif) return;
    notif.remove();
    activeNotifications.delete(message);
  }

  // ===== Auth Listener =====
  auth.onAuthStateChanged(user => {
    currentUser = user || null;
    userNameSpan.textContent = user ? (user.displayName || user.email) : "Guest";
    startOrdersListener();
  });

  // ===== Real-time Orders Listener =====
  function startOrdersListener() {
    stopOrdersListener();
    showLoader();

    const ordersRef = db.collection("orders");
    let query = currentUser
      ? ordersRef.where("userId", "==", currentUser.uid).orderBy("createdAt", "desc")
      : ordersRef.where("guestId", "==", guestId).orderBy("createdAt", "desc");

    ordersUnsub = query.onSnapshot(snapshot => {
      allOrders = [];
      snapshot.forEach(doc => {
        const data = doc.data();
        const status = (data.shipmentStatus || data.status || "Pending").trim();
        allOrders.push({
          id: doc.id,
          total: data.total || 0,
          items: data.items || [],
          status,
          createdAt: data.createdAt || data.timestamp,
          name: data.name || "",
          phone: data.phone || "",
          email: data.email || "",
          delivery: data.delivery || {},
          paymentMethod: data.paymentMethod || "â€”",
          paymentRef: data.paymentRef || "â€”"
        });
      });

      // âœ… HANDLE OPEN MODAL ON REAL-TIME UPDATE
if (!orderModal.classList.contains("hidden") && openedOrderId) {
  const updatedOrder = allOrders.find(o => o.id === openedOrderId);

  if (updatedOrder) {
    const statusLower = updatedOrder.status.toLowerCase();

    // ðŸ”’ AUTO-CLOSE EDIT MODAL IF STATUS CHANGES TO NON-EDITABLE
    if (
      openedOrderMode === "edit" &&
      NON_EDITABLE_STATUSES.includes(statusLower)
    ) {
      closeModal();
      showNotification(
        `Order moved to "${updatedOrder.status}". Edit mode closed.`,
        "warning"
      );
      return;
    }

    // ðŸ”„ OTHERWISE, JUST UPDATE THE MODAL CONTENT
    modalContent.innerHTML = generateModalContent(
      updatedOrder,
      openedOrderMode === "edit"
    );
  }
}
      applyOrderFilter(currentFilter);
      hideLoader();
    }, err => {
      console.error("Failed to load orders:", err);
      showNotification("Failed to load orders.", "error");
      hideLoader();
    });
  }

  function stopOrdersListener() {
    if(ordersUnsub) ordersUnsub();
    ordersUnsub = null;
  }

  // Filter Order
  window.filterOrders = (status)=>{
    showLoader();
    currentFilter = status;
    document.querySelectorAll(".status-btn").forEach(btn=>{
      if(btn.dataset.status===status){
        btn.classList.add("bg-pink-500","text-white");
        btn.classList.remove("bg-pink-100");
      } else {
        btn.classList.remove("bg-pink-500","text-white");
        btn.classList.add("bg-pink-100");
      }
    });
    applyOrderFilter(status);
    setTimeout(hideLoader, 400); // hide after filter animation
  };

  // Apply Order Filter
  function applyOrderFilter(status){
    const filtered = status==="All" ? allOrders : allOrders.filter(o=>o.status.toLowerCase()===status.toLowerCase());
    currentPage = 1;
    renderPagination(filtered);
    renderOrders(paginateOrders(filtered));
  }

  // Pagination
  function paginateOrders(list){ 
    return list.slice(
        (currentPage-1) * pageSize, 
      currentPage * pageSize
    ); 
  }

  // Render Pagination
  function renderPagination(list){
    let container = document.getElementById("paginationControls");
    if(!container && orderTableBody){
      container = document.createElement("div");
      container.id = "paginationControls";
      container.className = "flex items-center justify-center gap-3 mt-4 text-sm";
      orderTableBody.parentElement.appendChild(container);
    }
    if(!container) return;

    const totalPages = Math.ceil(list.length / pageSize);
    if(totalPages <= 1){ container.innerHTML=""; return; }

    const prevDisabled = currentPage === 1 ? "opacity-50 cursor-not-allowed" : "";
    const nextDisabled = currentPage === totalPages ? "opacity-50 cursor-not-allowed" : "";

    container.innerHTML = `
      <button onclick="changePage('prev')" class="px-3 py-1 rounded bg-pink-100 hover:bg-pink-200 ${prevDisabled}">Prev</button>
      <span>Page ${currentPage} of ${totalPages}</span>
      <button onclick="changePage('next')" class="px-3 py-1 rounded bg-pink-100 hover:bg-pink-200 ${nextDisabled}">Next</button>
    `;
  }

  // Change Page
  window.changePage = (dir)=>{
    showLoader();
    const filtered = currentFilter==="All" ? allOrders : allOrders.filter(o=>o.status.toLowerCase()===currentFilter.toLowerCase());
    const totalPages = Math.ceil(filtered.length/pageSize);
    if(dir==="next" && currentPage < totalPages) currentPage++;
    if(dir==="prev" && currentPage > 1) currentPage--;
    renderPagination(filtered);
    renderOrders(paginateOrders(filtered));
    setTimeout(hideLoader, 400);
  };

  // ===== Render Orders Table =====
  function renderOrders(orders){
    if(!orderTableBody) return;
    orderTableBody.innerHTML = "";

    if(!orders.length){
      orderTableBody.innerHTML = `<tr><td colspan="7" class="text-center text-gray-500 p-2">No orders found.</td></tr>`;
      return;
    }

    orders.forEach(order => {
      const dateStr = order.createdAt?.toDate ? order.createdAt.toDate().toLocaleString() 
        : order.createdAt?.seconds ? new Date(order.createdAt.seconds*1000).toLocaleString() 
        : "N/A";
      const totalStr = order.total?.toLocaleString() || "0";
      const itemsCount = order.items?.length || 0;
      const statusLower = order.status?.toLowerCase() || "";
      const statusColor = statusLower==="pending"?"bg-yellow-300 text-yellow-800":
        statusLower==="pending_confirmation"?"bg-yellow-200 text-yellow-900":
        statusLower==="shipped"?"bg-blue-300 text-blue-800":
        statusLower==="delivered"?"bg-green-300 text-green-800":"bg-gray-300 text-gray-800";
      const isEditable = ["pending","pending_confirmation"].includes(statusLower);

      const tr = document.createElement("tr");
      tr.className = "border-b hover:bg-gray-50";
      tr.innerHTML = `
        <td class="p-2 text-center">${dateStr}</td>
        <td class="p-2 text-center">â‚¦${totalStr}</td>
        <td class="p-2 text-center">${itemsCount}</td>
        <td class="p-2 text-center">
          <span class="px-2 py-1 rounded ${statusColor} text-sm font-semibold">${order.status}</span>
        </td>
        <td class="p-2 text-center">
          <button onclick="viewOrder('${order.id}')" class="ml-2 text-blue-500 hover:underline">View</button>
          <button onclick="editOrder('${order.id}')" class="ml-2 text-green-500 hover:underline" ${!isEditable?"disabled":""}>Edit</button>
        </td>
      `;
      orderTableBody.appendChild(tr);
    });
  }

  // ===== Modal =====
  window.closeModal = () => {
  orderModal.classList.add("hidden");
  document.body.style.overflow = "";
  document.body.style.pointerEvents = "";

  openedOrderId = null;
  openedOrderMode = "view";

  saveBtn.classList.add("hidden");
  saveBtn.onclick = null;
};

  orderModal.addEventListener("click",(e)=>{
    if(e.target===orderModal) closeModal();
  });

  window.viewOrder = (id) => {
  const order = allOrders.find(o => o.id === id);
  if (!order) return;

  openedOrderId = id;
  openedOrderMode = "view";

  saveBtn.classList.add("hidden");
  saveBtn.onclick = null;

  modalContent.innerHTML = generateModalContent(order, false);
  openModal();
};

  function openModal(){
    orderModal.classList.remove("hidden");
    document.body.style.overflow = "hidden";
    document.body.style.pointerEvents = "none";
    orderModal.style.pointerEvents = "auto";
  }

  // ===== Edit Order =====
window.editOrder = (id) => {
  const order = allOrders.find(o => o.id === id);
  if (!order || !["pending", "pending_confirmation"].includes(order.status?.toLowerCase())) return;

  openedOrderId = id;
  openedOrderMode = "edit";

  // Render modal in edit mode
  modalContent.innerHTML = generateModalContent(order, true);
  saveBtn.classList.remove("hidden");
  saveBtn.disabled = false;

  saveBtn.onclick = async () => {
    showLoader();
    saveBtn.disabled = true;

    try {
      // Get values from modal inputs
      const name = document.getElementById("editName").value;
      const phone = document.getElementById("editPhone").value;
      const email = document.getElementById("editEmail").value;
      const address = document.getElementById("editAddress").value;
      const lga = document.getElementById("editLGA").value;
      const state = document.getElementById("editState").value;

      // Update Firestore
      await db.collection("orders").doc(id).update({
        name,
        phone,
        email,
        delivery: {
          ...order.delivery,
          address,
          lga,
          state
        }
      });

      showNotification("Order updated successfully!");
      closeModal();

    } catch (err) {
      console.error(err);
      showNotification("Failed to update order.", "error");
    } finally {
      hideLoader();
      saveBtn.disabled = false;
    }
  };

  openModal();
};

  // Generate Modal Content
  function generateModalContent(order, isEdit) {
  const steps = ["Pending", "Shipped", "Delivered"];
  const normalizedStatus =
    steps.find(s => s.toLowerCase() === order.status.toLowerCase()) || "Pending";
  const statusIndex = steps.indexOf(normalizedStatus);

  // ===== Timeline / Status Bar =====
  const timelineHTML = `
    <h3 class="font-semibold text-gray-700 mb-2">Order Status</h3>
    <div class="flex items-center justify-between mb-4">
      <div class="flex-1 flex items-center">
        ${steps.map((step, i) => {
          const isActive = i <= statusIndex;
          const colorClass =
            step === "Pending" ? "bg-yellow-400" :
            step === "Shipped" ? "bg-blue-400" : "bg-green-400";
          const dotColor = isActive ? colorClass : "bg-gray-300";
          const lineColor = i < statusIndex ? colorClass : "bg-gray-300";
          return `
            <div class="w-3 h-3 rounded-full ${dotColor}"></div>
            ${i < steps.length - 1 ? `<div class="flex-1 mx-2 h-1 rounded ${lineColor}"></div>` : ""}
          `;
        }).join("")}
      </div>
    </div>
    <div class="flex justify-between text-xs text-gray-600 font-semibold mb-4">
      ${steps.map(s => `<span>${s}</span>`).join("")}
    </div>
  `;

  if (isEdit) {
    // ===== EDIT MODE =====
    return `
      ${timelineHTML}
      <h3 class="font-semibold text-gray-700 mb-3">Edit Customer Info</h3>
      <div class="grid grid-cols-1 gap-4">
        <div>
          <label class="block text-gray-600 text-sm mb-1" for="editName">Name</label>
          <input id="editName" value="${order.name || ''}" class="w-full border rounded-md px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-500"/>
        </div>
        <div>
          <label class="block text-gray-600 text-sm mb-1" for="editPhone">Phone</label>
          <input id="editPhone" value="${order.phone || ''}" class="w-full border rounded-md px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-500"/>
        </div>
        <div>
          <label class="block text-gray-600 text-sm mb-1" for="editEmail">Email</label>
          <input id="editEmail" value="${order.email || ''}" class="w-full border rounded-md px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-500"/>
        </div>
        <div>
          <label class="block text-gray-600 text-sm mb-1" for="editAddress">Address</label>
          <input id="editAddress" value="${order.delivery?.address || ''}" class="w-full border rounded-md px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-500"/>
        </div>
        <div>
          <label class="block text-gray-600 text-sm mb-1" for="editLGA">LGA</label>
          <input id="editLGA" value="${order.delivery?.lga || ''}" class="w-full border rounded-md px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-500"/>
        </div>
        <div>
          <label class="block text-gray-600 text-sm mb-1" for="editState">State</label>
          <input id="editState" value="${order.delivery?.state || ''}" class="w-full border rounded-md px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-500"/>
        </div>
      </div>

      <h3 class="font-semibold text-gray-700 mt-4 mb-2">Items</h3>
      <div class="space-y-1 text-sm">
        ${order.items.map(i => `
          <div class="flex justify-between border-b py-1">
            <span>${i.name}</span>
            <span>${i.quantity} Ã— â‚¦${i.price.toLocaleString()}</span>
          </div>
        `).join("")}
      </div>

      <div class="mt-4 flex justify-between items-center">
        <div class="font-bold text-lg">Total: â‚¦${Number(order.total).toLocaleString()}</div>
      </div>
    `;
  } else {
    // ===== VIEW MODE =====
    return `
      ${timelineHTML}
      <h3 class="font-semibold text-gray-700 mb-2">Customer Details</h3>
      <div class="space-y-1 text-sm text-gray-700">
        <p><strong>Name:</strong> ${order.name || "â€”"}</p>
        <p><strong>Phone:</strong> ${order.phone || "â€”"}</p>
        <p><strong>Email:</strong> ${order.email || "â€”"}</p>
      </div>

      <h3 class="font-semibold text-gray-700 mt-4 mb-2">Delivery Details</h3>
      <div class="space-y-1 text-sm text-gray-700">
        <p><strong>Country:</strong> ${order.delivery?.country || "â€”"}</p>
        <p><strong>State:</strong> ${order.delivery?.state || "â€”"}</p>
        <p><strong>LGA:</strong> ${order.delivery?.lga || "â€”"}</p>
        <p><strong>Address:</strong> ${order.delivery?.address || "â€”"}</p>
        <p><strong>Delivery Type:</strong> ${order.delivery?.type || "â€”"}</p>
        <p><strong>Delivery Company:</strong> ${order.delivery?.company || "â€”"}</p>
      </div>

      <h3 class="font-semibold text-gray-700 mt-4 mb-2">Order Info</h3>
      <div class="space-y-1 text-sm text-gray-700">
        <p><strong>Status:</strong> ${order.status}</p>
        <p><strong>Payment Method:</strong> ${order.paymentMethod || "â€”"}</p>
        <p><strong>Payment Ref:</strong> ${order.paymentRef || "â€”"}</p>
        <p><strong>Order Date:</strong> ${
          order.createdAt?.toDate
            ? order.createdAt.toDate().toLocaleString()
            : order.createdAt?.seconds
              ? new Date(order.createdAt.seconds * 1000).toLocaleString()
              : "â€”"
        }</p>
      </div>

      <h3 class="font-semibold text-gray-700 mt-4">Items</h3>
      <div class="space-y-1 text-sm">
        ${order.items.map(i => `
          <div class="flex justify-between border-b py-1">
            <span>${i.name}</span>
            <span>${i.quantity} Ã— â‚¦${i.price.toLocaleString()}</span>
          </div>
        `).join("")}
      </div>

      <div class="mt-3 text-right font-bold text-lg">
        Total: â‚¦${Number(order.total).toLocaleString()}
      </div>
    `;
  }
}
});
</script>
</body>
</html>